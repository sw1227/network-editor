(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{9628:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Xe}});var a=n(9799),o=n(4942),r=n(9008),i=n(7294),d=n(6158),s=n.n(d),l=n(8797),c=n(5113),u=n(6447),h=n(1519),p=n(8462),g=n(5438),m=n(7212),f=n(3946),x=n(9929),v=n(6893),y=n(7707),j=n(1849),Z=n(4519),w=n(4599);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L={currentNodeIdx:0,currentEdgeIdx:0,nodes:[],edges:[]},E=function(e,t){var n,o,r,i,d,l,c;switch(t.type){case"initMap":var u=new(s().Map)(t.payload);return b(b({},e),{},{map:u});case"clickMap":if(void 0!==e.selectedNodeForEdge){var h={lngLat:t.payload,id:e.currentNodeIdx},p={source:e.selectedNodeForEdge,target:h.id,id:e.currentEdgeIdx};return b(b({},e),{},{nodes:[].concat((0,a.Z)(e.nodes),[h]),currentNodeIdx:e.currentNodeIdx+1,currentEdgeIdx:e.currentEdgeIdx+1,edges:[].concat((0,a.Z)(e.edges),[p]),selectedNodeForEdge:void 0,editingEdge:void 0})}return b(b({},e),{},{nodes:[].concat((0,a.Z)(e.nodes),[{lngLat:t.payload,id:e.currentNodeIdx}]),currentNodeIdx:e.currentNodeIdx+1});case"hover":var g,m=t.payload;if(void 0!==e.hoverNodeId)null===(g=e.map)||void 0===g||g.setFeatureState({source:"nodes",id:e.hoverNodeId},{hover:!1});return null===(n=e.map)||void 0===n||n.setFeatureState({source:"nodes",id:m},{hover:!0}),b(b({},e),{},{hoverNodeId:m});case"mouseleave":var f;if(void 0!==e.hoverNodeId)null===(f=e.map)||void 0===f||f.setFeatureState({source:"nodes",id:e.hoverNodeId},{hover:!1});return b(b({},e),{},{hoverNodeId:void 0});case"clickNode":var x=t.payload;if(void 0!==e.selectedNodeForEdge){var v=(0,a.Z)(e.edges),y={source:e.selectedNodeForEdge,target:x,id:e.currentEdgeIdx};return y.source!==y.target&&v.push(y),b(b({},e),{},{currentEdgeIdx:e.currentEdgeIdx+1,edges:v,selectedNodeForEdge:void 0,editingEdge:void 0})}return b(b({},e),{},{selectedNodeForEdge:x});case"mousemove":if(void 0!==e.selectedNodeForEdge){var j=e.nodes.find((function(t){return t.id===e.selectedNodeForEdge})),Z=j?[j.lngLat,t.payload]:void 0;return b(b({},e),{},{editingEdge:Z})}case"escape":return void 0!==e.selectedNodeForEdge?b(b({},e),{},{selectedNodeForEdge:void 0,editingEdge:void 0}):e;case"removeNode":return b(b({},e),{},{nodes:e.nodes.filter((function(e){return e.id!==t.payload})),edges:e.edges.filter((function(e){return![e.source,e.target].includes(t.payload)}))});case"removeEdgeById":return b(b({},e),{},{edges:e.edges.filter((function(e){return e.id!==t.payload}))});case"hoverEdge":var w,M=t.payload;if(void 0!==e.hoverEdgeId)null===(w=e.map)||void 0===w||w.setFeatureState({source:"edges",id:e.hoverEdgeId},{hover:!1});return null===(o=e.map)||void 0===o||o.setFeatureState({source:"edges",id:M},{hover:!0}),b(b({},e),{},{hoverEdgeId:M});case"mouseleaveEdge":var E;if(void 0!==e.hoverEdgeId)null===(E=e.map)||void 0===E||E.setFeatureState({source:"edges",id:e.hoverEdgeId},{hover:!1});return b(b({},e),{},{hoverEdgeId:void 0});case"reset":return b(b({},L),{},{map:e.map});case"importNodeLinkJson":var S=t.payload,C=S.nodes,I=S.links,N=C.map((function(e){return{id:e.id,lngLat:new(s().LngLat)(e.lng,e.lat)}})),k=I.map((function(e,t){return{id:e.id||t,source:e.source,target:e.target}}));return b(b({},e),{},{nodes:N,edges:k,currentNodeIdx:Math.max.apply(Math,(0,a.Z)(N.map((function(e){return e.id}))))+1,currentEdgeIdx:Math.max.apply(Math,(0,a.Z)(k.map((function(e){return e.id}))))+1});case"setImage":var O=t.payload;return b(b({},e),{},{imageUrl:O.src,imageShape:{width:O.width,height:O.height},imageShapeMeter:{width:O.width,height:O.height},imageCenterLngLat:null===(r=e.map)||void 0===r?void 0:r.getCenter()});case"updateImageShapeMeter":var F=t.payload,_=F.width,P=F.height;return b(b({},e),{},{imageShapeMeter:{width:_||(null===(i=e.imageShapeMeter)||void 0===i?void 0:i.width)||0,height:P||(null===(d=e.imageShapeMeter)||void 0===d?void 0:d.height)||0}});case"updateImageRotationDeg":var D=t.payload;return b(b({},e),{},{imageRotationDeg:D});case"updateImageCenter":var R=t.payload,A=R.lng,B=R.lat;return b(b({},e),{},{imageCenterLngLat:new(s().LngLat)(A||(null===(l=e.imageCenterLngLat)||void 0===l?void 0:l.lng)||0,B||(null===(c=e.imageCenterLngLat)||void 0===c?void 0:c.lat)||0)});default:return e}},S=function(e){return{type:"FeatureCollection",features:e.map((function(e){return{type:"Feature",id:e.id,geometry:{type:"Point",coordinates:[e.lngLat.lng,e.lngLat.lat]},properties:{}}}))}},C=function(e,t){return{type:"FeatureCollection",features:e.map((function(e){return I(e,t)}))}},I=function(e,t){var n=t.find((function(t){return t.id===e.source})),a=t.find((function(t){return t.id===e.target}));return{type:"Feature",id:e.id,geometry:{type:"LineString",coordinates:n&&a?[[n.lngLat.lng,n.lngLat.lat],[a.lngLat.lng,a.lngLat.lat]]:[]},properties:{}}},N=function(e){return{type:"Feature",geometry:{type:"LineString",coordinates:e?[[e[0].lng,e[0].lat],[e[1].lng,e[1].lat]]:[]},properties:{}}},k={id:"nodes",type:"circle",source:"nodes",layout:{},paint:{"circle-radius":6,"circle-color":"#f08","circle-opacity":.4,"circle-stroke-width":["case",["boolean",["feature-state","hover"],!1],2,0],"circle-stroke-color":"#f00"}},O={id:"edges",type:"line",source:"edges",layout:{},paint:{"line-color":"#f08","line-opacity":.4,"line-width":["case",["boolean",["feature-state","hover"],!1],6,3]}},F={id:"editingEdge",type:"line",source:"editingEdge",layout:{},paint:{"line-color":"#f08","line-opacity":.4,"line-width":3,"line-dasharray":[1,1]}},_={id:"raster-image",type:"raster",source:"raster-image",paint:{"raster-fade-duration":0,"raster-opacity":.4}},P=n(5671),D=n(3144),R=function(e){return Math.PI/180*e},A=function(e){return 180/Math.PI*e},B=function(e,t){var n=R(e),a=t.x,o=t.y;return{x:Math.cos(n)*a-Math.sin(n)*o,y:Math.sin(n)*a+Math.cos(n)*o}},z=.9999,T=6378137,U=1/595.514444202,W={lng:139+50/60,lat:36},H=function(){function e(t){var n=this;(0,P.Z)(this,e),(0,o.Z)(this,"phi0",void 0),(0,o.Z)(this,"lambda0",void 0),(0,o.Z)(this,"arrayA",void 0),(0,o.Z)(this,"arrayAlpha",void 0),(0,o.Z)(this,"arrayBeta",void 0),(0,o.Z)(this,"arrayDelta",void 0),(0,o.Z)(this,"A_",void 0),(0,o.Z)(this,"S_",void 0),this.phi0=R(t.lat),this.lambda0=R(t.lng),this.arrayA=J(U),this.arrayAlpha=X(U),this.arrayBeta=Y(U),this.arrayDelta=q(U),this.A_=z*T/(1+U)*this.arrayA[0],this.S_=z*T/(1+U)*(this.arrayA[0]*this.phi0+this.arrayA.slice(1).reduce((function(e,t,a){return e+t*Math.sin(2*(a+1)*n.phi0)}),0))}return(0,D.Z)(e,[{key:"XYToLngLat",value:function(e){var t=e.x,n=e.y,a=(t+this.S_)/this.A_,o=n/this.A_,r=a-this.arrayBeta.reduce((function(e,t,n){return e+t*Math.sin(2*(n+1)*a)*Math.cosh(2*(n+1)*o)}),0),i=o-this.arrayBeta.reduce((function(e,t,n){return e+t*Math.cos(2*(n+1)*a)*Math.sinh(2*(n+1)*o)}),0),d=Math.asin(Math.sin(r)/Math.cosh(i)),s=d+this.arrayDelta.reduce((function(e,t,n){return e+t*Math.sin(2*(n+1)*d)}),0),l=this.lambda0+Math.atan2(Math.sinh(i),Math.cos(r));return{lng:A(l),lat:A(s)}}},{key:"lngLatToXY",value:function(e){var t=e.lng,n=e.lat,a=R(n),o=R(t),r=Math.cos(o-this.lambda0),i=Math.sin(o-this.lambda0),d=Math.sinh(Math.atanh(Math.sin(a))-2*Math.sqrt(U)/(1+U)*Math.atanh(2*Math.sqrt(U)/(1+U)*Math.sin(a))),s=Math.sqrt(1+d*d),l=Math.atan2(d,r),c=Math.atanh(i/s);return{x:this.A_*(l+this.arrayAlpha.reduce((function(e,t,n){return e+t*Math.sin(2*(n+1)*l)*Math.cosh(2*(n+1)*c)}),0))-this.S_,y:this.A_*(c+this.arrayAlpha.reduce((function(e,t,n){return e+t*Math.cos(2*(n+1)*l)*Math.sinh(2*(n+1)*c)}),0))}}}]),e}(),J=function(e){return[1+Math.pow(e,2)/4+Math.pow(e,4)/64,-1.5*(e-Math.pow(e,3)/8-Math.pow(e,5)/64),15/16*(Math.pow(e,2)-Math.pow(e,4)/4),-35/48*(Math.pow(e,3)-5/16*Math.pow(e,5)),315/512*Math.pow(e,4),-693/1280*Math.pow(e,5)]},X=function(e){return[.5*e-2/3*Math.pow(e,2)+5/16*Math.pow(e,3)+41/180*Math.pow(e,4)-127/288*Math.pow(e,5),13/48*Math.pow(e,2)-.6*Math.pow(e,3)+557/1440*Math.pow(e,4)+281/630*Math.pow(e,5),61/240*Math.pow(e,3)-103/140*Math.pow(e,4)+15061/26880*Math.pow(e,5),49561/161280*Math.pow(e,4)-179/168*Math.pow(e,5),34729/80640*Math.pow(e,5)]},Y=function(e){return[.5*e-2/3*Math.pow(e,2)+37/96*Math.pow(e,3)-1/360*Math.pow(e,4)-81/512*Math.pow(e,5),1/48*Math.pow(e,2)+1/15*Math.pow(e,3)-437/1440*Math.pow(e,4)+46/105*Math.pow(e,5),17/480*Math.pow(e,3)-37/840*Math.pow(e,4)-209/4480*Math.pow(e,5),4397/161280*Math.pow(e,4)-11/504*Math.pow(e,5),4583/161280*Math.pow(e,5)]},q=function(e){return[2*e-2/3*Math.pow(e,2)-2*Math.pow(e,3)+116/45*Math.pow(e,4)+26/45*Math.pow(e,5)-2854/675*Math.pow(e,6),7/3*Math.pow(e,2)-1.6*Math.pow(e,3)-227/45*Math.pow(e,4)+2704/315*Math.pow(e,5)+2323/945*Math.pow(e,6),56/15*Math.pow(e,3)-136/35*Math.pow(e,4)-1262/105*Math.pow(e,5)+73814/2835*Math.pow(e,6),4279/630*Math.pow(e,4)-332/35*Math.pow(e,5)-399572/14175*Math.pow(e,6),4174/315*Math.pow(e,5)-144838/6237*Math.pow(e,6),601676/22275*Math.pow(e,6)]},G=n(7906),Q=n(295),K=n(3252),V=n(2882),$=n(3184),ee=n(3816),te=n(1733),ne=n(9308),ae=n(7922),oe=n(8619),re=n(796),ie=n(9953),de=n(181),se=n(3508),le=n(5893),ce=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},ue=function(e){var t=e.nodes,n=e.hoverNodeId,a=e.onEnterRow,o=e.onLeaveRow,r=e.onDeleteRow,d=(0,i.useState)(!1),s=d[0],l=d[1];return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)(oe.Z,{onClick:function(){l(!s)},children:[(0,le.jsx)(re.Z,{children:(0,le.jsx)(ne.Z,{})}),(0,le.jsx)(ie.Z,{primary:"Nodes"}),s?(0,le.jsx)(de.Z,{}):(0,le.jsx)(se.Z,{})]}),(0,le.jsx)(ae.Z,{in:s,timeout:"auto",unmountOnExit:!0,children:(0,le.jsx)(V.Z,{component:c.Z,elevation:0,children:(0,le.jsxs)(G.Z,{sx:{minWidth:20},size:"small","aria-label":"a dense table",children:[(0,le.jsx)($.Z,{children:(0,le.jsxs)(ee.Z,{children:[(0,le.jsx)(K.Z,{align:"center",children:"id"}),(0,le.jsx)(K.Z,{align:"center",children:"latitude"}),(0,le.jsx)(K.Z,{align:"center",children:"longitude"}),(0,le.jsx)(K.Z,{align:"center",children:"Delete"})]})}),(0,le.jsx)(Q.Z,{children:t.map((function(e){return(0,le.jsxs)(he,{sx:{"&:last-child td, &:last-child th":{border:0}},onMouseEnter:a(e.id),onMouseLeave:o,style:{background:n===e.id?"#def":"white"},children:[(0,le.jsx)(K.Z,{component:"th",scope:"row",children:e.id}),(0,le.jsx)(K.Z,{align:"left",children:ce(e.lngLat.lat,6)}),(0,le.jsx)(K.Z,{align:"left",children:ce(e.lngLat.lng,6)}),(0,le.jsx)(K.Z,{align:"center",children:(0,le.jsx)(f.Z,{"aria-label":"delete",size:"small",onClick:r(e.id),children:(0,le.jsx)(te.Z,{fontSize:"inherit"})})})]},e.id)}))})]})})})]})},he=(0,l.ZP)(ee.Z).withConfig({displayName:"nodetable__HoverRow",componentId:"sc-14axea-0"})(["&:hover{background:#def;}"]),pe=n(8141),ge=function(e){var t=e.edges,n=e.hoverEdgeId,a=e.onEnterRow,o=e.onLeaveRow,r=e.onDeleteRow,d=(0,i.useState)(!1),s=d[0],l=d[1];return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)(oe.Z,{onClick:function(){l(!s)},children:[(0,le.jsx)(re.Z,{children:(0,le.jsx)(pe.Z,{})}),(0,le.jsx)(ie.Z,{primary:"Edges"}),s?(0,le.jsx)(de.Z,{}):(0,le.jsx)(se.Z,{})]}),(0,le.jsx)(ae.Z,{in:s,timeout:"auto",unmountOnExit:!0,children:(0,le.jsx)(V.Z,{component:c.Z,elevation:0,children:(0,le.jsxs)(G.Z,{sx:{minWidth:20},size:"small","aria-label":"a dense table",children:[(0,le.jsx)($.Z,{children:(0,le.jsxs)(ee.Z,{children:[(0,le.jsx)(K.Z,{align:"center",children:"id"}),(0,le.jsx)(K.Z,{align:"center",children:"Edge info"}),(0,le.jsx)(K.Z,{align:"center",children:"Delete"})]})}),(0,le.jsx)(Q.Z,{children:t.map((function(e){return(0,le.jsxs)(me,{sx:{"&:last-child td, &:last-child th":{border:0}},onMouseEnter:a(e.id),onMouseLeave:o,style:{background:n===e.id?"#def":"white"},children:[(0,le.jsx)(K.Z,{component:"th",scope:"row",children:e.id}),(0,le.jsxs)(K.Z,{align:"left",children:["Node ",e.source," \u2192 Node ",e.target]}),(0,le.jsx)(K.Z,{align:"center",children:(0,le.jsx)(f.Z,{"aria-label":"delete",size:"small",onClick:r(e.id),children:(0,le.jsx)(te.Z,{fontSize:"inherit"})})})]},e.id)}))})]})})})]})},me=(0,l.ZP)(ee.Z).withConfig({displayName:"edgetable__HoverRow",componentId:"sc-1il4u5w-0"})(["&:hover{background:#def;}"]),fe=n(7357),xe=n(3321),ve=n(6798),ye=n(1423),je=(0,l.ZP)(ye.Z).withConfig({displayName:"common__StyledModal",componentId:"sc-ndkjj4-0"})(["position:fixed;z-index:1300;right:0;bottom:0;top:0;left:0;display:flex;align-items:center;justify-content:center;"]),Ze=(0,l.ZP)("div").withConfig({displayName:"common__Backdrop",componentId:"sc-ndkjj4-1"})(["z-index:-1;position:fixed;right:0;bottom:0;top:0;left:0;background-color:rgba(0,0,0,0.5);-webkit-tap-highlight-color:transparent;"]),we={width:400,bgcolor:"background.paper",p:2,px:4,pb:3},Me=(0,l.ZP)("div").withConfig({displayName:"common__NoMarginDiv",componentId:"sc-ndkjj4-2"})(["margin:0 !important;"]),be=function(e){var t=e.open,n=e.onCloseModal,a=e.onImportNodeLinkJson,o=(0,i.useState)(!1),r=o[0],d=o[1],s=(0,i.useState)(null),l=s[0],c=s[1];return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(ve.Z,{open:r,autoHideDuration:6e3,onClose:function(){return d(!1)},message:"Import failed",action:(0,le.jsx)(xe.Z,{size:"small",onClick:function(){return d(!1)},children:"Close"})}),(0,le.jsx)(je,{"aria-labelledby":"modal-title","aria-describedby":"modal-description",open:t,onClose:function(){c(null),n()},BackdropComponent:Ze,children:(0,le.jsx)(fe.Z,{sx:we,children:(0,le.jsxs)(u.Z,{spacing:2,children:[(0,le.jsx)("h2",{id:"modal-title",children:"Import network"}),(0,le.jsxs)(Me,{children:["Format: ",(0,le.jsx)("a",{href:"https://networkx.org/documentation/stable/reference/readwrite/json_graph.html",children:"Node-link json"})]}),(0,le.jsx)("input",{type:"file",id:"upload",accept:".json,.geojson",onChange:function(e){c(e.target.files)}}),(0,le.jsx)(xe.Z,{variant:"contained",startIcon:(0,le.jsx)(Z.Z,{}),onClick:function(){if(l&&!(l.length<1)){var e=new FileReader;e.onload=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.result;if("string"===typeof n){var o=JSON.parse(n);!function(e){var t,n,a=null===(t=e.nodes)||void 0===t?void 0:t.every((function(e){return"id"in e&&"lng"in e&&"lat"in e})),o=null===(n=e.links)||void 0===n?void 0:n.every((function(e){return"source"in e&&"target"in e}));return a&&o}(o)?d(!0):(a(o),c(null))}},e.readAsText(l[0])}},disabled:!l||l.length<1,children:"Reset map & Import"})]})})})]})},Le=n(7781),Ee=n(2890),Se=n(480),Ce=n(4054),Ie=n(476),Ne=function(e){var t=e.open,n=e.onCloseModal,o=e.nodes,r=e.edges,d=(0,i.useState)("node-link"),s=d[0],l=d[1];return(0,le.jsx)(je,{"aria-labelledby":"modal-title","aria-describedby":"modal-description",open:t,onClose:n,BackdropComponent:Ze,children:(0,le.jsx)(fe.Z,{sx:we,children:(0,le.jsxs)(u.Z,{spacing:2,children:[(0,le.jsx)("h2",{id:"modal-title",children:"Export network"}),(0,le.jsxs)(Ce.Z,{component:"fieldset",children:[(0,le.jsx)(Ie.Z,{component:"legend",children:"Format"}),(0,le.jsxs)(Ee.Z,{"aria-label":"gender",name:"controlled-radio-buttons-group",value:s,onChange:function(e){l(e.target.value)},children:[(0,le.jsx)(v.Z,{title:"https://networkx.org/documentation/stable/reference/readwrite/json_graph.html",placement:"left",children:(0,le.jsx)(Se.Z,{value:"node-link",control:(0,le.jsx)(Le.Z,{}),label:"Node-link json"})}),(0,le.jsx)(v.Z,{title:"FeatureCollection of nodes(Point) and edges(LineString)",placement:"left",children:(0,le.jsx)(Se.Z,{value:"geojson",control:(0,le.jsx)(Le.Z,{}),label:"GeoJSON"})})]})]}),(0,le.jsx)(xe.Z,{variant:"contained",startIcon:(0,le.jsx)(x.Z,{}),onClick:function(){var e="node-link"===s?function(e,t){return{nodes:e.map((function(e){return{id:e.id,lng:e.lngLat.lng,lat:e.lngLat.lat}})),links:t.map((function(e){return{source:e.source,target:e.target}}))}}(o,r):function(e,t){return{type:"FeatureCollection",features:[].concat((0,a.Z)(e.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:[e.lngLat.lng,e.lngLat.lat]},properties:{id:e.id}}}))),(0,a.Z)(t.map((function(t){var n=e.find((function(e){return e.id===t.source})),a=e.find((function(e){return e.id===t.target}));return{type:"Feature",geometry:{type:"LineString",coordinates:n&&a?[[n.lngLat.lng,n.lngLat.lat],[a.lngLat.lng,a.lngLat.lat]]:[]},properties:{source:t.source,target:t.target,id:t.id}}}))))}}(o,r),t=new Blob([JSON.stringify(e)],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(t),i.download="export.json",document.body.appendChild(i),i.click(),document.body.removeChild(i),n()},children:"Export"})]})})})},ke=function(e){var t=e.open,n=e.onCloseModal,a=e.onImportImage,o=(0,i.useState)(!1),r=o[0],d=o[1],s=(0,i.useState)(null),l=s[0],c=s[1],h=function(){c(null),n()};return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(ve.Z,{open:r,autoHideDuration:6e3,onClose:function(){return d(!1)},message:"Import failed",action:(0,le.jsx)(xe.Z,{size:"small",onClick:function(){return d(!1)},children:"Close"})}),(0,le.jsx)(je,{"aria-labelledby":"modal-title","aria-describedby":"modal-description",open:t,onClose:h,BackdropComponent:Ze,children:(0,le.jsx)(fe.Z,{sx:we,children:(0,le.jsxs)(u.Z,{spacing:2,children:[(0,le.jsx)("h2",{id:"modal-title",children:"Add raster image overlay"}),(0,le.jsx)(Me,{children:"Select an image"}),(0,le.jsx)("input",{type:"file",id:"upload",accept:"image/*",onChange:function(e){c(e.target.files)}}),(0,le.jsx)(xe.Z,{variant:"contained",startIcon:(0,le.jsx)(Z.Z,{}),onClick:function(){if(l&&!(l.length<1)){var e=new Image;e.src=URL.createObjectURL(l[0]),e.onload=function(){a(e)},h()}},disabled:!l||l.length<1,children:"Add image"})]})})})]})},Oe=function(e){var t=e.open,n=e.onCloseModal,a=e.onReset;return(0,le.jsx)(je,{"aria-labelledby":"modal-title","aria-describedby":"modal-description",open:t,onClose:n,BackdropComponent:Ze,children:(0,le.jsx)(fe.Z,{sx:we,children:(0,le.jsxs)(u.Z,{spacing:2,children:[(0,le.jsx)("h2",{id:"modal-title",children:"Reset"}),(0,le.jsx)(Me,{children:"All the nodes and edges will be deleted."}),(0,le.jsx)(xe.Z,{variant:"contained",color:"warning",onClick:function(){a(),n()},children:"Reset"})]})})})},Fe=n(4161),_e={Default_ja:"mapbox://styles/sw1227/ckqyzf3tm1s0v17rv3rnaxgxm",Light_en:"mapbox://styles/mapbox/light-v10",Dark_en:"mapbox://styles/mapbox/dark-v10",Outdoors_en:"mapbox://styles/mapbox/outdoors-v11",Satellite:"mapbox://styles/mapbox/satellite-v9"},Pe=function(e){var t=e.mapStyle,n=e.onSelect,a=(0,i.useState)(!1),o=a[0],r=a[1],d=function(e){return function(){n(e),r(!1)}};return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)(oe.Z,{onClick:function(){r(!o)},children:[(0,le.jsx)(re.Z,{children:(0,le.jsx)(Fe.Z,{})}),(0,le.jsx)(ie.Z,{primary:"Base map: ".concat(t)}),o?(0,le.jsx)(de.Z,{}):(0,le.jsx)(se.Z,{})]}),(0,le.jsx)(ae.Z,{in:o,timeout:"auto",unmountOnExit:!0,children:(0,le.jsx)(p.Z,{component:"div",disablePadding:!0,children:Object.keys(_e).map((function(e){return(0,le.jsx)(oe.Z,{sx:{pl:4},onClick:d(e),children:(0,le.jsx)(ie.Z,{primary:e})},e)}))})})]})},De=n(6693),Re=n(8075),Ae=n(7109),Be=function(e){var t=e.initWidth,n=e.initHeight,a=e.initCenter,o=e.onChangeWidth,r=e.onChangeHeight,d=e.onChangeRotation,s=e.onChangeLng,l=e.onChangeLat,c=(0,i.useState)(!1),u=c[0],h=c[1],p=(0,i.useState)(String(t)),m=p[0],f=p[1],x=(0,i.useState)(String(n)),v=x[0],y=x[1],j=(0,i.useState)("0"),Z=j[0],w=j[1],M=(0,i.useState)(String(a.lng)),b=M[0],L=M[1],E=(0,i.useState)(String(a.lat)),S=E[0],C=E[1];return(0,i.useEffect)((function(){var e=parseFloat(m);isNaN(e)||o(e)}),[m]),(0,i.useEffect)((function(){var e=parseFloat(v);isNaN(e)||r(e)}),[v]),(0,i.useEffect)((function(){var e=parseFloat(Z);isNaN(e)||d(e)}),[Z]),(0,i.useEffect)((function(){var e=parseFloat(b);isNaN(e)||s(e)}),[b]),(0,i.useEffect)((function(){var e=parseFloat(S);isNaN(e)||l(e)}),[S]),(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)(oe.Z,{onClick:function(){h(!u)},children:[(0,le.jsx)(re.Z,{children:(0,le.jsx)(De.Z,{})}),(0,le.jsx)(ie.Z,{primary:"Image Overlay"}),u?(0,le.jsx)(de.Z,{}):(0,le.jsx)(se.Z,{})]}),(0,le.jsxs)(ae.Z,{in:u,timeout:"auto",unmountOnExit:!0,children:[(0,le.jsxs)(ze,{subheader:(0,le.jsx)(g.Z,{children:"Actual size of image [meter]"}),children:[(0,le.jsx)(Re.Z,{id:"width-input",label:"Width",variant:"standard",InputProps:{endAdornment:(0,le.jsx)(Ae.Z,{position:"end",children:"[m]"})},error:isNaN(parseFloat(m)),value:m,onChange:function(e){return f(e.target.value)}}),(0,le.jsx)("br",{}),(0,le.jsx)(Re.Z,{id:"height-input",label:"Height",variant:"standard",InputProps:{endAdornment:(0,le.jsx)(Ae.Z,{position:"end",children:"[m]"})},error:isNaN(parseFloat(v)),value:v,onChange:function(e){return y(e.target.value)}})]}),(0,le.jsx)(ze,{subheader:(0,le.jsx)(g.Z,{children:"Rotation"}),children:(0,le.jsx)(Re.Z,{id:"rotation-input",label:"Rotation",variant:"standard",InputProps:{endAdornment:(0,le.jsx)(Ae.Z,{position:"end",children:"[deg]"})},error:isNaN(parseFloat(Z)),value:Z,onChange:function(e){return w(e.target.value)}})}),(0,le.jsxs)(ze,{subheader:(0,le.jsx)(g.Z,{children:"Location"}),children:[(0,le.jsx)(Re.Z,{id:"lng-input",label:"Longitude",variant:"standard",InputProps:{endAdornment:(0,le.jsx)(Ae.Z,{position:"end",children:"[deg]"})},error:isNaN(parseFloat(b)),value:b,onChange:function(e){return L(e.target.value)}}),(0,le.jsx)("br",{}),(0,le.jsx)(Re.Z,{id:"lng-input",label:"Latitude",variant:"standard",InputProps:{endAdornment:(0,le.jsx)(Ae.Z,{position:"end",children:"[deg]"})},error:isNaN(parseFloat(S)),value:S,onChange:function(e){return C(e.target.value)}})]})]})]})},ze=(0,l.ZP)(p.Z).withConfig({displayName:"overlay__InputList",componentId:"sc-1kads67-0"})(["padding:16px;"]),Te=n(1990),Ue=n.n(Te);function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Je={accessToken:"pk.eyJ1Ijoic3cxMjI3IiwiYSI6ImNrbngyazRhcjBtY3Iyd3RnODhjbDhscWsifQ.6Uc-Lboqa0WhZbnnFJWFSA",container:"mapbox",localIdeographFontFamily:"sans-serif",center:new(s().LngLat)(139.744,35.72),zoom:16},Xe=function(){var e,t,n=(0,i.useReducer)(E,L),o=n[0],d=n[1],s=(0,i.useState)(!1),l=s[0],c=s[1],M=(0,i.useState)(!1),b=M[0],I=M[1],P=(0,i.useState)(!1),D=P[0],R=P[1],A=(0,i.useState)(!1),z=A[0],T=A[1],U=(0,i.useState)("Default_ja"),J=U[0],X=U[1];(0,i.useEffect)((function(){d({type:"initMap",payload:He(He({},Je),{},{style:_e[J]})})}),[J]),(0,i.useEffect)((function(){if(o.map){var e=o.map;e.on("style.load",(function(){e.addSource("nodes",{type:"geojson",data:S(o.nodes)}),e.addSource("edges",{type:"geojson",data:C(o.edges,o.nodes)}),e.addSource("editingEdge",{type:"geojson",data:N()}),e.addLayer(k),e.addLayer(O),e.addLayer(F),Y(),e.on("click","nodes",(function(e){var t,n=null===(t=e.features)||void 0===t?void 0:t[0].id;void 0!==n&&d({type:"clickNode",payload:n}),e.originalEvent.preventDefault()})),e.on("click",(function(e){e.originalEvent.defaultPrevented||d({type:"clickMap",payload:e.lngLat})})),e.on("mousemove","nodes",(function(e){var t,n=null===(t=e.features)||void 0===t?void 0:t[0].id;void 0!==n&&d({type:"hover",payload:n})})),e.on("mouseleave","nodes",(function(){d({type:"mouseleave"})})),e.on("mousemove","edges",(function(e){var t,n=null===(t=e.features)||void 0===t?void 0:t[0].id;void 0!==n&&d({type:"hoverEdge",payload:n})})),e.on("mouseleave","edges",(function(){d({type:"mouseleaveEdge"})})),e.on("mousemove",(function(e){d({type:"mousemove",payload:e.lngLat})})),e.getCanvas().addEventListener("keydown",(function(e){e.preventDefault(),"Escape"===e.key&&d({type:"escape"})}))}))}}),[o.map]),(0,i.useEffect)((function(){var e,t=null===(e=o.map)||void 0===e?void 0:e.getSource("nodes");t&&t.setData(S(o.nodes))}),[o.nodes]),(0,i.useEffect)((function(){var e,t=null===(e=o.map)||void 0===e?void 0:e.getSource("edges");t&&t.setData(C(o.edges,o.nodes))}),[o.edges]),(0,i.useEffect)((function(){var e,t=null===(e=o.map)||void 0===e?void 0:e.getSource("editingEdge");o.map&&t&&(o.editingEdge?(t.setData(N(o.editingEdge)),o.map.setLayoutProperty("editingEdge","visibility","visible")):o.map.setLayoutProperty("editingEdge","visibility","none"))}),[o.editingEdge]),(0,i.useEffect)((function(){Y()}),[o.imageUrl,o.imageShapeMeter,o.imageRotationDeg,o.imageCenterLngLat]);var Y=function(){var e,t,n,r;if(null!==(e=o.map)&&void 0!==e&&e.getLayer("raster-image")&&o.map.removeLayer("raster-image"),null!==(t=o.map)&&void 0!==t&&t.getSource("raster-image")&&o.map.removeSource("raster-image"),o.map&&o.imageUrl&&o.imageShape&&o.imageShapeMeter&&o.imageCenterLngLat){var i=new H(W),d=i.lngLatToXY(o.imageCenterLngLat),s=d.x,l=d.y,c=o.imageRotationDeg||0,u=B(-c,{x:+o.imageShapeMeter.height/2,y:-o.imageShapeMeter.width/2}),h=B(-c,{x:+o.imageShapeMeter.height/2,y:+o.imageShapeMeter.width/2}),p=B(-c,{x:-o.imageShapeMeter.height/2,y:+o.imageShapeMeter.width/2}),g=B(-c,{x:-o.imageShapeMeter.height/2,y:-o.imageShapeMeter.width/2}),m={nw:i.XYToLngLat({x:s+u.x,y:l+u.y}),ne:i.XYToLngLat({x:s+h.x,y:l+h.y}),se:i.XYToLngLat({x:s+p.x,y:l+p.y}),sw:i.XYToLngLat({x:s+g.x,y:l+g.y})};o.map.addSource("raster-image",{type:"image",url:o.imageUrl,coordinates:[[m.nw.lng,m.nw.lat],[m.ne.lng,m.ne.lat],[m.se.lng,m.se.lat],[m.sw.lng,m.sw.lat]]}),null===(n=o.map)||void 0===n||n.addLayer(_);var f=Math.min.apply(Math,(0,a.Z)(Object.values(m).map((function(e){return e.lng})))),x=Math.max.apply(Math,(0,a.Z)(Object.values(m).map((function(e){return e.lng})))),v=Math.min.apply(Math,(0,a.Z)(Object.values(m).map((function(e){return e.lat})))),y=Math.max.apply(Math,(0,a.Z)(Object.values(m).map((function(e){return e.lat}))));null===(r=o.map)||void 0===r||r.fitBounds([[f,v],[x,y]])}};return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)(r.default,{children:[(0,le.jsx)("title",{children:"Network editor"}),(0,le.jsx)("link",{href:"https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.css",rel:"stylesheet"})]}),(0,le.jsx)("div",{id:"mapbox",className:Ue().mapbox}),(0,le.jsx)(be,{open:l,onCloseModal:function(){return c(!1)},onImportNodeLinkJson:function(e){d({type:"reset"}),d({type:"importNodeLinkJson",payload:e}),c(!1)}}),(0,le.jsx)(Ne,{open:b,onCloseModal:function(){return I(!1)},nodes:o.nodes,edges:o.edges}),(0,le.jsx)(ke,{open:D,onCloseModal:function(){return R(!1)},onImportImage:function(e){d({type:"setImage",payload:e})}}),(0,le.jsx)(Oe,{open:z,onCloseModal:function(){return T(!1)},onReset:function(){d({type:"reset"})}}),(0,le.jsxs)(Ye,{children:[(0,le.jsx)(m.ZP,{secondaryAction:(0,le.jsxs)(u.Z,{direction:"row",spacing:1,children:[(0,le.jsx)(v.Z,{title:"Import",children:(0,le.jsx)(f.Z,{edge:"end",onClick:function(){return c(!0)},children:(0,le.jsx)(Z.Z,{})})}),(0,le.jsx)(v.Z,{title:"Export",children:(0,le.jsx)(f.Z,{edge:"end",onClick:function(){return I(!0)},children:(0,le.jsx)(x.Z,{})})}),(0,le.jsx)(v.Z,{title:"Add raster image overlay",children:(0,le.jsx)(f.Z,{edge:"end",onClick:function(){return R(!0)},children:(0,le.jsx)(w.Z,{})})}),(0,le.jsx)(v.Z,{title:"Fit to nodes",children:(0,le.jsx)("span",{children:(0,le.jsx)(f.Z,{edge:"end",onClick:function(){var e;if(!(o.nodes.length<3)){var t=Math.min.apply(Math,(0,a.Z)(o.nodes.map((function(e){return e.lngLat.lng})))),n=Math.max.apply(Math,(0,a.Z)(o.nodes.map((function(e){return e.lngLat.lng})))),r=Math.min.apply(Math,(0,a.Z)(o.nodes.map((function(e){return e.lngLat.lat})))),i=Math.max.apply(Math,(0,a.Z)(o.nodes.map((function(e){return e.lngLat.lat}))));null===(e=o.map)||void 0===e||e.fitBounds([[t,r],[n,i]])}},disabled:o.nodes.length<3,children:(0,le.jsx)(y.Z,{})})})}),(0,le.jsx)(v.Z,{title:"Reset",children:(0,le.jsx)("span",{children:(0,le.jsx)(f.Z,{edge:"end",onClick:function(){return T(!0)},disabled:o.nodes.length<1&&!o.imageUrl,children:(0,le.jsx)(j.Z,{})})})})]}),children:(0,le.jsx)("h4",{children:"Network Editor"})}),(0,le.jsxs)(p.Z,{sx:{width:"100%",maxWidth:360,bgcolor:"background.paper"},subheader:(0,le.jsx)(g.Z,{children:"Settings"}),children:[(0,le.jsx)(h.Z,{}),(0,le.jsx)(ue,{nodes:o.nodes,hoverNodeId:o.hoverNodeId,onEnterRow:function(e){return function(){return d({type:"hover",payload:e})}},onLeaveRow:function(){return d({type:"mouseleave"})},onDeleteRow:function(e){return function(){d({type:"removeNode",payload:e})}}}),(0,le.jsx)(h.Z,{}),(0,le.jsx)(ge,{edges:o.edges,hoverEdgeId:o.hoverEdgeId,onEnterRow:function(e){return function(){d({type:"hoverEdge",payload:e})}},onLeaveRow:function(){d({type:"mouseleaveEdge"})},onDeleteRow:function(e){return function(){d({type:"removeEdgeById",payload:e})}}}),(0,le.jsx)(h.Z,{}),(0,le.jsx)(Pe,{mapStyle:J,onSelect:function(e){return X(e)}}),(0,le.jsx)(h.Z,{}),o.imageUrl?(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(Be,{initWidth:(null===(e=o.imageShape)||void 0===e?void 0:e.width)||0,initHeight:(null===(t=o.imageShape)||void 0===t?void 0:t.height)||0,initCenter:o.imageCenterLngLat||Je.center,onChangeWidth:function(e){d({type:"updateImageShapeMeter",payload:{width:e}})},onChangeHeight:function(e){d({type:"updateImageShapeMeter",payload:{height:e}})},onChangeRotation:function(e){d({type:"updateImageRotationDeg",payload:e})},onChangeLng:function(e){d({type:"updateImageCenter",payload:{lng:e}})},onChangeLat:function(e){d({type:"updateImageCenter",payload:{lat:e}})}}),(0,le.jsx)(h.Z,{})]}):null]})]})]})},Ye=(0,l.ZP)(c.Z).withConfig({displayName:"map__SidePaper",componentId:"sc-urva01-0"})(["position:absolute;left:0px;top:0px;width:350px;height:100vh;padding:0px;overflow:scroll;"])},134:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return n(9628)}])},1990:function(e){e.exports={mapbox:"Map_mapbox__GQDDM"}}},function(e){e.O(0,[634,547,774,888,179],(function(){return t=134,e(e.s=t);var t}));var t=e.O();_N_E=t}]);